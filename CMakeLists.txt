cmake_minimum_required(VERSION 3.21)
project(pieces)

set(CMAKE_CXX_STANDARD 23)

add_compile_options(-fuse-ld=lld)
add_compile_options(-Wall -Wextra -Werror)
add_compile_options(-Wno-parentheses)
add_compile_options(-Wno-missing-field-initializers)
add_compile_options(-Wno-unused-function)
add_compile_options(-Wno-unused-label)
add_compile_options(-Wno-unused-parameter)
add_compile_options(-Wno-unknown-pragmas)
add_compile_options(-Wno-sign-compare)
add_compile_options(-Wno-unused-command-line-argument)
set(CMAKE_SHARED_LINKER_FLAGS "-Wl,--no-undefined")
set(CMAKE_INTERPROCEDURAL_OPTIMIZATION TRUE)
set(CMAKE_EXPORT_COMPILE_COMMANDS YES)

add_executable(pieces wasm.cpp Piece.cpp Shape.cpp)
target_link_options(pieces INTERFACE -sWASM_BIGINT)
target_link_options(pieces PRIVATE -sALLOW_MEMORY_GROWTH=1)
target_link_options(pieces PRIVATE -sENVIRONMENT=web)
target_link_options(pieces PRIVATE -sMODULARIZE=1)
target_link_options(pieces PRIVATE -sEXPORT_NAME=Pieces)
target_link_libraries(pieces PRIVATE embind)

add_executable(profile main.cpp Piece.cpp Shape.cpp)
target_compile_options(profile PRIVATE -g)
target_link_options(profile INTERFACE -sWASM_BIGINT)
target_link_options(profile PRIVATE --profiling)
target_link_options(profile PRIVATE -sWASM=1)
target_link_options(profile PRIVATE -sSTANDALONE_WASM=1)
target_link_options(profile PRIVATE -sENVIRONMENT=shell)
target_link_options(profile PRIVATE -sMODULARIZE=0)
